private Predicate<ProductsRelation> isProductInvolved(Long productId) {
    return relation -> productId.equals(relation.getSourceId()) || productId.equals(relation.getTargetId());
}

private Predicate<ProductsRelation> hasRelationType(ProductsRelationType relationType) {
    // If relationType is null, return all relations; otherwise, match the specified type.
    return relation -> relationType == null || relationType.equals(relation.getRelationType());
}
